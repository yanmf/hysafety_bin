## 变更记录
> 记录每次修订的内容，方便追溯。

## 项目背景
> 本项目基于只能穿戴设备，对学生安全，防溺水，防欺凌所研发的管理系统。

## 功能模块
![](https://cdn.nlark.com/yuque/0/2024/jpeg/123708/1713943380922-78634368-74e8-4640-a19b-df48a5123f76.jpeg)

## API 设计
### 设置围栏区域
:::tips

- **URL**：`/api/fence/create`
- **Method**：`POST`
- **需要登录**：暂定
- **需要鉴权**：暂定
:::
#### 请求参数
| 参数 |  | 类型 | 字段含义 | 备注 |
| --- | --- | --- | --- | --- |
| **fence_name** |  | string(128) | 围栏名称 | 1 到 30 个字符 |
| **inner_or_outer** | 
 | int | 内外圈 | 0不区分内外圈1为内圈2为外圈 |
| **fence_level** |  | int | 围栏等级 | 区分危险地带，警告地带等 |
| **vertexes** |  | array | 顶点坐标集合 | 顶点顺序可按顺时针或逆时针排列
长度3-100个之间 |
| 
 | **longitude** | double | 经度 |  |
| 
 | **latitude** | double | 纬度 |  |
| **coord_type** |  | string | 坐标类型 | 坐标类型定义如下：
wgs84：GPS经纬度
gcj02：国测局经纬度
bd09ll：百度经纬度 |
| **sign** |  | string | 签名校验 | 暂定统一规则 |

#### 请求示例
```json
{
    "fence_name": "汾河围栏1",
    "coord_type": "bd09ll",
    "sign": "",
    "vertexes":[
      {"longitude":123456.12,"latitude":987654.00},
      {"longitude":123456.12,"latitude":987654.00},
      {"longitude":123456.12,"latitude":987654.00},
    ],
}
```
#### 成功响应
:::tips
**条件**：请求参数合法，并且用户身份校验通过。
**状态码：**`200 OK`
**响应示例**：响应会将创建的围栏唯一id返回，并且返回顶点坐标，坐标类型与围栏名称。
:::
| 参数 |  |  | 类型 | 字段含义 | 备注 |
| --- | --- | --- | --- | --- | --- |
| status |  |  | int32 | 状态码 | 返回状态，0为成功 |
| message |  |  | 
 | 响应信息 | 对status的中文描述 |
| data |  |  | 
 | 返回数据 | 
 |
| 
 | **fence_name** | 
 | string(128) | 围栏名称 | 1 到 30 个字符 |
| 
 | **inner_or_outer** | 
 | int | 内外圈 | 0不区分内外圈1为内圈2为外圈 |
| 
 | **fence_level** |  | int | 围栏等级 | 区分危险地带，警告地带等数字越大越危险 |
| 
 | **vertexes** | 
 | array | 顶点坐标集合 | 顶点顺序可按顺时针或逆时针排列
长度3-100个之间 |
| 
 | 
 | **longitude** | double | 经度 |  |
| 
 | 
 | **latitude** | double | 纬度 |  |
| 
 | **coord_type** |  | string | 坐标类型 | 坐标类型定义如下：
wgs84：GPS经纬度
gcj02：国测局经纬度
bd09ll：百度经纬度 |
| 
 | **fence_id** |  | int32 | 围栏id | id唯一 |


### 查询围栏区域
:::tips

- **URL**：`/api/fence/query_list`
- **Method**：`POST`
- **需要登录**：暂定
- **需要鉴权**：暂定
:::
#### 请求参数
| 参数 | 类型 | 字段含义 | 备注 |
| --- | --- | --- | --- |
| **fence_ids** | array<int32> | 围栏id列表 | 当这个字段为null的时候查询所有的否则指定查询 |
| **sign** | string | 签名校验 | 暂定统一规则 |

#### 请求示例
```json
{
    "fence_ids": [],
    "sign": "",
}
```
#### 成功响应
:::tips
**条件**：请求参数合法，并且用户身份校验通过。
**状态码：**`200 OK`
**响应示例**：响应会将围栏列表返回。
:::
| 参数 |  |  | 类型 | 字段含义 | 备注 |
| --- | --- | --- | --- | --- | --- |
| status |  |  | int32 | 状态码 | 返回状态，0为成功 |
| message |  |  | 
 | 响应信息 | 对status的中文描述 |
| data |  |  | array | 返回数据 |  |
| 
 | **fence_name** |  | string(128) | 围栏名称 | 1 到 30 个字符 |
| 
 | **fence_level** |  | int | 围栏等级 | 区分危险地带，警告地带等 |
| 
 | **inner_or_outer** |  | int | 内外圈 | 0不区分内外圈1为内圈2为外圈 |
| 
 | **vertexes** |  | array | 顶点坐标集合 | 顶点顺序可按顺时针或逆时针排列
长度3-100个之间 |
| 
 |  | **longitude** | double | 经度 |  |
| 
 |  | **latitude** | double | 纬度 |  |
| 
 | **coord_type** |  | string | 坐标类型 | 坐标类型定义如下：
wgs84：GPS经纬度
gcj02：国测局经纬度
bd09ll：百度经纬度 |
| 
 | **fence_id** |  | int32 | 围栏id | id唯一 |

### 删除围栏区域
:::tips

- **URL**：`/api/fence/delete`
- **Method**：`POST`
- **需要登录**：暂定
- **需要鉴权**：暂定
:::
#### 请求参数
| 参数 | 类型 | 字段含义 | 备注 |
| --- | --- | --- | --- |
| **fence_ids** | array<int32> | 围栏id列表 | 当这个字段为null的时候删除所有 |
| **sign** | string | 签名校验 | 暂定统一规则 |

#### 请求示例
```json
{
    "fence_ids": [],
    "sign": "",
}
```
#### 成功响应
:::tips
**条件**：请求参数合法，并且用户身份校验通过。
**状态码：**`200 OK`
**响应示例**：响应会将围栏列表返回。
:::
| 参数 |  |  | 类型 | 字段含义 | 备注 |
| --- | --- | --- | --- | --- | --- |
| status |  |  | int32 | 状态码 | 返回状态，0为成功 |
| message |  |  | 
 | 响应信息 | 对status的中文描述 |
| data |  |  | 
 | 返回数据 |  |
| 
 | **fence_ids** |  | array<int> | 围栏id列表 | 
 |


## 数据库设计

